<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TestX Protocol ($TESTX)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.13.5/ethers.umd.min.js"></script>
    <style>
        :root { --gold:#FFD700; --orange:#FF4500; --dark-orange:#FF8C00; --glass:rgba(255,140,0,0.3); }
        body { margin:0; font-family:Segoe UI,Arial; background:linear-gradient(135deg,var(--dark-orange),var(--orange)); color:#fff; min-height:100vh; }
        .container { max-width:960px; margin:auto; padding:20px; }
        header { text-align:center; padding:60px 20px; background:var(--glass); border-radius:24px; border:2px solid var(--gold); }
        .logo-img { width:300px; border-radius:50%; border:8px solid var(--gold); box-shadow:0 0 60px var(--orange); }
        h1 { font-size:3.5em; color:#000; text-shadow:0 4px 12px #fff; }
        .tagline { font-size:1.8em; }
        .warning { background:#000; padding:20px; border-radius:12px; text-align:center; border:2px solid var(--gold); margin:20px 0; }
        #connectBtn { background:linear-gradient(45deg,#fff,var(--gold)); color:#000; padding:18px 40px; font-size:1.6em; border:none; border-radius:50px; cursor:pointer; }
        #connectBtn.connected { background:linear-gradient(45deg,#00FF00,#32CD32); }
        .wallet-address { font-size:1.4em; margin-top:15px; display:none; }
        nav { display:flex; flex-wrap:wrap; justify-content:center; gap:12px; margin:40px 0; }
        nav button { background:var(--glass); border:1px solid var(--gold); padding:14px 28px; border-radius:50px; color:#fff; cursor:pointer; }
        nav button.active { background:linear-gradient(var(--gold),#fff); color:#000; }
        .section { display:none; background:#000; border-radius:24px; padding:30px; border:2px solid var(--gold); }
        .section.active { display:block; }
        .card { background:rgba(0,0,0,0.9); border-radius:18px; padding:24px; border:1px solid var(--gold); }
        input[type=number] { width:100%; padding:14px; border-radius:12px; background:rgba(255,255,255,0.2); color:#fff; font-size:1.1em; border:none; }
        .main-btn { background:linear-gradient(var(--gold),#fff); color:#000; padding:16px; font-size:1.3em; width:100%; margin-top:10px; border:none; border-radius:12px; cursor:pointer; font-weight:bold; }
        .main-btn:disabled { background:#888; cursor:not-allowed; }
        .stat { font-size:1.5em; margin:15px 0; }
        .progress { height:32px; background:rgba(255,255,255,0.3); border-radius:16px; overflow:hidden; position:relative; margin:20px 0; }
        .bar { height:100%; background:linear-gradient(to right,#fff,var(--gold)); width:0%; transition:width 1s; }
        .progress-text { position:absolute; width:100%; text-align:center; line-height:32px; color:#000; font-weight:bold; }
        .preview { font-size:1.3em; color:#00FF00; font-weight:bold; }
        footer { text-align:center; padding:40px; color:#000; font-weight:bold; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <img src="https://cdn.discordapp.com/attachments/1295797949774135326/1319930299171188766/image.png" class="logo-img">
            <h1>TestX Protocol ($TESTX)</h1>
            <p class="tagline">Our goal is not speed ‚Äî it is legacy.</p>
        </header>

        <div class="warning">
            ‚ö†Ô∏è TESTING ON BASE SEPOLIA (TESTNET) ‚ö†Ô∏è<br>
            Contract: 0x45d1c787A0d86AE8d7FEa33412a5d80d86B7445b
        </div>

        <div style="text-align:center;padding:20px;">
            <button id="connectBtn">Connect Wallet</button>
            <p class="wallet-address" id="walletAddress"></p>
        </div>

        <nav>
            <button class="active" data-section="presale">Presale</button>
            <button data-section="staking">Staking</button>
            <button data-section="rewards">Staking Reward</button>
            <button data-section="vesting">Vesting</button>
            <button data-section="airdrop">Airdrop</button>
            <button data-section="whitepaper">Whitepaper</button>
        </nav>

        <div id="presale" class="section active">
            <h2>Presale ‚Äì 8,000 $TESTX per 1 ETH</h2>
            <div class="card">
                <p class="stat">Raised: <strong><span id="totalRaised">0</span> ETH</strong></p>
                <p class="stat">Sold: <strong><span id="tokensSold">0</span> / 500,000 $TESTX</strong></p>
                <div class="progress"><div class="bar" id="presaleBar"></div><div class="progress-text" id="progressText">0%</div></div>
                <p class="stat">Your Contribution: <strong><span id="yourContribution">0</span> ETH</strong></p>
                <p class="stat">Your Balance: <strong><span id="userBalance">0</span> $TESTX</strong></p>
                <input type="number" id="ethAmount" placeholder="ETH amount (min 0.0125 - max 1.25)" step="0.001">
                <p class="preview" id="tokenPreview">You'll receive: 0 $TESTX</p>
                <button id="contributeBtn" class="main-btn" disabled>Contribute ETH</button>
                <button id="claimTokensBtn" class="main-btn" style="display:none;">Claim Presale Tokens</button>
            </div>
        </div>

        <div id="staking" class="section">
            <h2>Staking</h2>
            <div class="card">
                <p class="stat">Staked: <strong><span id="stakedAmount">0</span> $TESTX</strong></p>
                <p>Unlock: <span id="unlockTime">‚Äî</span></p>
                <input type="number" id="stakeAmount" placeholder="Amount">
                <button id="stakeBtn" class="main-btn" disabled>Stake</button>
                <button id="unstakeBtn" class="main-btn" disabled>Unstake</button>
            </div>
        </div>

        <div id="rewards" class="section">
            <h2>Staking Rewards</h2>
            <div class="card">
                <p class="stat">Pending: <strong><span id="pendingRewards">0</span> $TESTX</strong></p>
                <button id="claimRewardsBtn" class="main-btn" disabled>Claim Rewards</button>
            </div>
        </div>

        <div id="vesting" class="section">
            <h2>Vesting Status</h2>
            <div class="card">
                <p>Owner (0xE133...0001): <strong><span id="ownerReleasable">0</span> $TESTX</strong></p>
                <button id="claimOwnerBtn" class="main-btn" disabled>Claim Owner</button>
                <p>Growth (0xafee...8A21): <strong><span id="growthReleasable">0</span> $TESTX</strong></p>
                <button id="claimGrowthBtn" class="main-btn" disabled>Claim Growth</button>
            </div>
        </div>

        <div id="airdrop" class="section"><h2>Airdrop</h2><div class="card"><p>Coming soon</p></div></div>
        <div id="whitepaper" class="section"><h2>Whitepaper</h2><div class="card"><p>Coming soon</p></div></div>

        <footer>¬© 2025 TestX Protocol ‚Ä¢ Base Sepolia Testnet üî•</footer>
    </div>

    <script>
    window.addEventListener("load", async () => {
        // ================== ELEMENTS ==================
        const connectBtn = document.getElementById("connectBtn");
        const walletAddress = document.getElementById("walletAddress");
        const totalRaised = document.getElementById("totalRaised");
        const tokensSold = document.getElementById("tokensSold");
        const presaleBar = document.getElementById("presaleBar");
        const progressText = document.getElementById("progressText");
        const yourContribution = document.getElementById("yourContribution");
        const userBalance = document.getElementById("userBalance");
        const ethAmount = document.getElementById("ethAmount");
        const tokenPreview = document.getElementById("tokenPreview");
        const contributeBtn = document.getElementById("contributeBtn");
        const stakeAmount = document.getElementById("stakeAmount");
        const stakeBtn = document.getElementById("stakeBtn");
        const unstakeBtn = document.getElementById("unstakeBtn");
        const stakedAmount = document.getElementById("stakedAmount");
        const unlockTime = document.getElementById("unlockTime");
        const pendingRewards = document.getElementById("pendingRewards");
        const claimRewardsBtn = document.getElementById("claimRewardsBtn");
        const claimTokensBtn = document.getElementById("claimTokensBtn");
        const ownerReleasable = document.getElementById("ownerReleasable");
        const growthReleasable = document.getElementById("growthReleasable");
        const claimOwnerBtn = document.getElementById("claimOwnerBtn");
        const claimGrowthBtn = document.getElementById("claimGrowthBtn");

        // ================== CONFIG ==================
        const TOKEN_CONTRACT = "0x45d1c787A0d86AE8d7FEa33412a5d80d86B7445b";
        const OWNER = "0xE1330576Dd2254224F046624E05ecA7f51C50001".toLowerCase();
        const GROWTH = "0xafee6142bDBb2ea7882Bfc60145E647FdA368A21".toLowerCase();
        const ABI = [
            "function balanceOf(address) view returns (uint256)",
            "function decimals() view returns (uint8)",
            "function totalPresaleRaised() view returns (uint256)",
            "function totalPresaleTokensSold() view returns (uint256)",
            "function presaleContribution(address) view returns (uint256)",
            "function tradingEnabled() view returns (bool)",
            "function claimPresaleTokens()",
            "function stake(uint256)",
            "function unstake(uint256)",
            "function calculatePendingRewards(address) view returns (uint256)",
            "function claimRewards()",
            "function getUserStake(address) view returns (uint256,uint256,uint256,uint256)",
            "function releasableOwnerVested() view returns (uint256)",
            "function releasableGrowthVested() view returns (uint256)",
            "function claimOwnerVested()",
            "function claimGrowthVested()"
        ];

        let provider, signer, contract, user, DECIMALS = 18;

        // ================== CONNECT ==================
        async function connect() {
            if (!window.ethereum) return alert("Install MetaMask");
            provider = new ethers.BrowserProvider(window.ethereum);
            signer = await provider.getSigner();
            user = (await signer.getAddress()).toLowerCase();
            contract = new ethers.Contract(TOKEN_CONTRACT, ABI, signer);
            DECIMALS = await contract.decimals();

            connectBtn.textContent = "CONNECTED üî•";
            connectBtn.classList.add("connected");
            connectBtn.disabled = true;

            walletAddress.textContent = user.slice(0,6)+'...'+user.slice(-4);
            walletAddress.style.display = 'block';

            await loadData();
        }

        // ================== LOAD DATA ==================
        async function loadData() {
            if(!contract) return;

            const trading = await contract.tradingEnabled();

            const raised = await contract.totalPresaleRaised();
            totalRaised.textContent = Number(ethers.formatEther(raised)).toFixed(4);

            const sold = await contract.totalPresaleTokensSold();
            const soldNum = Number(ethers.formatUnits(sold, DECIMALS));
            tokensSold.textContent = soldNum.toLocaleString() + " / 500,000";
            const perc = (soldNum / 500000) * 100;
            presaleBar.style.width = perc + "%";
            progressText.textContent = perc.toFixed(1) + "%";

            const bal = await contract.balanceOf(user);
            userBalance.textContent = ethers.formatUnits(bal, DECIMALS);

            const contrib = await contract.presaleContribution(user);
            yourContribution.textContent = ethers.formatEther(contrib);

            const stake = await contract.getUserStake(user);
            stakedAmount.textContent = ethers.formatUnits(stake[0], DECIMALS);
            unlockTime.textContent = stake[1] > 0 ? new Date(Number(stake[3])*1000).toLocaleDateString() : "‚Äî";

            const pending = await contract.calculatePendingRewards(user);
            pendingRewards.textContent = ethers.formatUnits(pending, DECIMALS);

            const ownerRel = await contract.releasableOwnerVested();
            ownerReleasable.textContent = ethers.formatUnits(ownerRel, DECIMALS);
            claimOwnerBtn.disabled = ownerRel === 0n || user !== OWNER;

            const growthRel = await contract.releasableGrowthVested();
            growthReleasable.textContent = ethers.formatUnits(growthRel, DECIMALS);
            claimGrowthBtn.disabled = growthRel === 0n || user !== GROWTH;

            contributeBtn.disabled = false;
            stakeBtn.disabled = !trading;
            unstakeBtn.disabled = !trading;
            claimRewardsBtn.disabled = pending === 0n;
            claimTokensBtn.style.display = trading && contrib > 0n ? "block" : "none";
        }

        // ================== PRESALE ==================
        contributeBtn.onclick = async () => {
            const eth = parseFloat(ethAmount.value);
            if(!eth || eth<0.0125 || eth>1.25) return alert("Amount must be 0.0125 ‚Äì 1.25 ETH");
            const tx = await signer.sendTransaction({to:TOKEN_CONTRACT, value:ethers.parseEther(eth.toString())});
            await tx.wait();
            ethAmount.value = "";
            tokenPreview.textContent = "You'll receive: 0 TESTER";
            await loadData();
        };
        ethAmount.oninput = () => {
            const eth = parseFloat(ethAmount.value) || 0;
            tokenPreview.textContent = `You'll receive: ${(eth*8000).toFixed(0)} TESTER`;
        };

        claimTokensBtn.onclick = async () => {
            const tx = await contract.claimPresaleTokens();
            await tx.wait();
            await loadData();
        };

        // ================== STAKING ==================
        stakeBtn.onclick = async () => {
            const amt = stakeAmount.value;
            if(!amt || amt<=0) return alert("Invalid amount");
            const tx = await contract.stake(ethers.parseUnits(amt, DECIMALS));
            await tx.wait();
            stakeAmount.value = "";
            await loadData();
        };
        unstakeBtn.onclick = async () => {
            const amt = stakeAmount.value;
            if(!amt || amt<=0) return alert("Invalid amount");
            const tx = await contract.unstake(ethers.parseUnits(amt, DECIMALS));
            await tx.wait();
            stakeAmount.value = "";
            await loadData();
        };

        // ================== REWARDS ==================
        claimRewardsBtn.onclick = async () => {
            const tx = await contract.claimRewards();
            await tx.wait();
            await loadData();
        };

        // ================== VESTING ==================
        claimOwnerBtn.onclick = async () => {
            const tx = await contract.claimOwnerVested();
            await tx.wait();
            await loadData();
        };
        claimGrowthBtn.onclick = async () => {
            const tx = await contract.claimGrowthVested();
            await tx.wait();
            await loadData();
        };

        // ================== NAV ==================
        document.querySelectorAll("nav button").forEach(btn => {
            btn.onclick = () => {
                document.querySelectorAll("nav button").forEach(b => b.classList.remove("active"));
                document.querySelectorAll(".section").forEach(s => s.classList.remove("active"));
                btn.classList.add("active");
                document.getElementById(btn.dataset.section).classList.add("active");
            };
        });

        connectBtn.onclick = connect;

        // Auto-connect if MetaMask already authorized
        if(window.ethereum) {
            const accounts = await ethereum.request({ method: "eth_accounts" });
            if(accounts.length>0) connect();
        }
    });
    </script>
</body>
</html>