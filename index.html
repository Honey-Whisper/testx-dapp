<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rox Protocol ($ROX)</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
:root { --gold:#FFD700; --orange:#FF4500; --dark-orange:#FF8C00; --glass:rgba(255,140,0,0.3); --green:#00FF00; }
body { margin:0; font-family:Segoe UI,Arial; background:linear-gradient(135deg,var(--dark-orange),var(--orange)); color:#fff; min-height:100vh; }
.container { max-width:960px; margin:auto; padding:20px; }
header { text-align:center; padding:60px 20px; background:var(--glass); border-radius:24px; border:2px solid var(--gold); }
.logo-img { width:300px; border-radius:50%; border:8px solid var(--gold); box-shadow:0 0 60px var(--orange); }
h1 { font-size:3.5em; color:#000; text-shadow:0 4px 12px #fff; }
.tagline { font-size:1.8em; }
.warning { background:#000; padding:20px; border-radius:12px; text-align:center; border:2px solid var(--gold); margin:20px 0; }
#connectBtn, #disconnectBtn { padding:18px 40px; font-size:1.6em; border:none; border-radius:50px; cursor:pointer; }
#connectBtn { background:linear-gradient(45deg,#fff,var(--gold)); color:#000; }
#disconnectBtn { background:#888; color:#fff; display:none; margin-left:10px; }
.wallet-address { font-size:1.4em; margin-top:15px; display:none; }
nav { display:flex; flex-wrap:wrap; justify-content:center; gap:12px; margin:40px 0; }
nav button { background:var(--glass); border:1px solid var(--gold); padding:14px 28px; border-radius:50px; color:#fff; cursor:pointer; }
nav button.active { background:linear-gradient(var(--gold),#fff); color:#000; }
.section { display:none; background:#000; border-radius:24px; padding:30px; border:2px solid var(--gold); }
.section.active { display:block; }
.card { background:rgba(0,0,0,0.9); border-radius:18px; padding:24px; border:1px solid var(--gold); margin-bottom:20px; text-align:center; }
input[type=number], input[type=text] { width:100%; padding:14px; border-radius:12px; background:rgba(255,255,255,0.2); color:#fff; font-size:1.1em; border:none; margin:10px 0; }
.main-btn { background:linear-gradient(var(--gold),#fff); color:#000; padding:16px; font-size:1.3em; width:100%; margin-top:10px; border:none; border-radius:12px; cursor:pointer; font-weight:bold; }
.main-btn:disabled { background:#888; cursor:not-allowed; opacity:0.6; }
.stat { font-size:1.5em; margin:15px 0; }
canvas { background:#111; border-radius:16px; margin-top:20px; }
.pool-box { background:#000; padding:15px; border-radius:12px; border:2px solid var(--green); text-align:center; margin:20px 0; }
.pool-amount { font-size:2.2em; font-weight:bold; color:var(--green); }
.compulsory { background:rgba(0,255,0,0.15); border:2px dashed var(--green); padding:15px; border-radius:12px; margin:20px 0; }
.sybil-box { background:rgba(255,215,0,0.15); border:2px solid var(--gold); padding:20px; border-radius:12px; margin:30px 0; }
footer { text-align:center; padding:40px; color:#000; font-weight:bold; }
</style>
</head>
<body>
<div class="container">
<header>
<img src="https://cdn.discordapp.com/attachments/1295797949774135326/1319930299171188766/image.png" class="logo-img" alt="Rox Logo">
<h1>Rox Protocol ($ROX)</h1>
<p class="tagline">Our goal is not speed ‚Äî it is legacy.</p>
</header>
<div class="warning">
‚ö†Ô∏è TESTING ON BASE SEPOLIA (TESTNET) ‚ö†Ô∏è<br>
Contract: <span id="displayContract">0x3cf0...4683 (Airdrop)</span>
</div>
<div style="text-align:center;padding:20px;">
<button id="connectBtn">Connect Wallet</button>
<button id="disconnectBtn">Disconnect Wallet</button>
<p class="wallet-address" id="walletAddress"></p>
</div>
<nav>
<button class="active" data-section="presale">Presale üí∞</button>
<button data-section="staking">Staking üí∏</button>
<button data-section="rewards">Staking Reward üéÅ</button>
<button data-section="vesting">Vesting ‚õìÔ∏è</button>
<button data-section="circulating">Circulating Supply ‚öôÔ∏è</button>
<button data-section="transparency">Transparency Vault üíé</button>
<button data-section="holdersgrowth">Holders Growth üí´</button>
<button data-section="tokenomics">Tokenomics ü™ô</button>
<button data-section="charts">Charts üíπ</button>
<button data-section="legacyvault">Legacy Vault üîÆ</button>
<button data-section="airdrop">Airdrop Campaign</button>
</nav>

<!-- Other sections same as before -->

<div id="airdrop" class="section">
<h2>Airdrop Campaign</h2>
<div class="card">
    <p>Earn XP by completing tasks below. Top 1,000 ranked participants will share the airdrop rewards.</p>
    <div class="pool-box">
        <strong>Total Airdrop Pool Locked On-Chain</strong><br>
        <span class="pool-amount" id="airdropPoolBalance">Loading...</span> <strong style="color:var(--green);">$ROX</strong>
    </div>
    <a href="https://sepolia.basescan.org/address/0x3cf099e1237272e6cd6591bd6460367a5d074683" target="_blank">
        <button class="main-btn" style="padding:12px 30px;">Verify Pool on BaseScan üîç</button>
    </a>

    <div style="margin:20px 0; text-align:left;">
        <p><strong>Your Current XP:</strong> <span id="userAirdropXP" style="font-size:2em; color:var(--green); font-weight:bold;">Connect wallet</span></p>
        <p><strong>Your Current Rank:</strong> <span id="userAirdropRank" style="font-size:1.8em; color:#FFD700;">-</span></p>
        <p><strong>Total Participants:</strong> <span id="airdropParticipants">0</span> / 1500 <span id="airdropFull" style="color:#FF0000; display:none;">(FULL!)</span></p>
        <p><strong>Eligible for Airdrop?</strong> <span id="airdropEligible" style="font-size:1.4em;">Connect wallet</span></p>
    </div>

    <!-- Sybil Proof / Eligibility Section (Replaced Leaderboard) -->
    <div class="sybil-box">
        <h3 style="color:var(--gold); margin-top:0;">üõ°Ô∏è Sybil Resistance & Eligibility Proof</h3>
        <p>To ensure fair distribution and prevent sybil attacks, eligibility requires completion of the two compulsory tasks below.</p>
        <p><strong>Only users who complete both tasks will be ranked and eligible for $ROX airdrop rewards.</strong></p>
    </div>

    <!-- Compulsory Tasks -->
    <div class="compulsory">
        <h3 style="color:var(--green);">Compulsory Tasks (Required for Eligibility)</h3>
        <button class="main-btn" id="nftBonusBtn" style="margin:8px 0; padding:12px; font-size:1.4em;">Claim NFT Holder Bonus (+500 XP)</button><br>
        <button class="main-btn" id="predictBtnAirdrop" style="margin:8px 0; padding:12px; font-size:1.4em;">Submit Legacy Vault Price Prediction (+300 XP)</button>
    </div>

    <!-- Optional Tasks -->
    <div style="background:rgba(255,215,0,0.2); padding:15px; border-radius:12px; margin:20px 0; border:2px dashed var(--gold);">
        <p style="margin:5px 0;"><strong>Optional Tasks (Boost Your Rank)</strong></p>
        <button class="main-btn" id="dailyCheckinBtn" style="margin:8px 0; padding:12px;">Daily Check-in (+5 XP)</button><br>
        <button class="main-btn" id="weeklyBonusBtn" style="margin:8px 0; padding:12px;">Claim Weekly Streak (+30 XP)</button><br>
        <button class="main-btn" id="monthlyBonusBtn" style="margin:8px 0; padding:12px;">Claim Monthly Bonus (+80 XP)</button><br>
        <button class="main-btn" id="holderBonusBtn" style="margin:8px 0; padding:12px;">Claim Token Holder Bonus (up to +600 XP)</button><br>
        <button class="main-btn" id="campaignBonusBtn" style="margin:8px 0; padding:12px;">Claim Campaign Bonus (+100 XP)</button><br>
        <button class="main-btn" id="claimAirdropBtn" disabled style="margin:20px 0; font-size:1.4em; padding:16px;">Claim Your Airdrop Rewards (60% Immediate)</button>
    </div>

    <button class="main-btn" id="refreshLeaderboardBtn" style="margin-top:10px;">Refresh Data</button>
</div>
</div>

<!-- Other sections (presale, staking, etc.) remain the same -->

<footer>¬© 2025 Rox Protocol ‚Ä¢ Base Sepolia Testnet üî•</footer>
</div>

<script>
let provider, signer, airdropContract, tokenContract, userAddress = null;

async function connectWallet() {
  if (!window.ethereum) return alert('Please install MetaMask!');
  try {
    await window.ethereum.request({ method: 'eth_requestAccounts' });
    provider = new ethers.providers.Web3Provider(window.ethereum);
    signer = provider.getSigner();
    userAddress = await signer.getAddress();

    document.getElementById('walletAddress').textContent = userAddress.slice(0,6) + '...' + userAddress.slice(-4);
    document.getElementById('walletAddress').style.display = 'block';
    document.getElementById('connectBtn').style.display = 'none';
    document.getElementById('disconnectBtn').style.display = 'inline-block';

    initContractsAndLoad();
  } catch (err) {
    alert('Connection failed: ' + err.message);
  }
}

function disconnectWallet() {
  provider = signer = airdropContract = tokenContract = userAddress = null;
  document.getElementById('walletAddress').style.display = 'none';
  document.getElementById('connectBtn').style.display = 'inline-block';
  document.getElementById('disconnectBtn').style.display = 'none';

  document.getElementById('userAirdropXP').innerText = 'Connect wallet';
  document.getElementById('airdropEligible').innerText = 'Connect wallet';
  document.getElementById('userAirdropRank').innerText = '-';
  document.getElementById('airdropPoolBalance').innerText = 'Loading...';
}

function initContractsAndLoad() {
  const AIRDROP_ADDRESS = "0x3cf099e1237272e6cd6591bd6460367a5d074683";
  const ROX_ADDRESS = "0x228c276d885d254b464b69dcfbc75dd96f8a2491";

  const AIRDROP_ABI = [
    "function dailyCheckin() external",
    "function claimWeeklyBonus() external",
    "function claimMonthlyBonus() external",
    "function claimHolderBonus() external",
    "function claimNFTBonus() external",
    "function claimCampaignBonus() external",
    "function claimAirdrop() external",
    "function xpOf(address) view returns (uint256)",
    "function isEligible(address) view returns (bool)",
    "function totalParticipants() view returns (uint256)"
  ];

  const TOKEN_ABI = ["function balanceOf(address) view returns (uint256)"];

  airdropContract = new ethers.Contract(AIRDROP_ADDRESS, AIRDROP_ABI, signer);
  tokenContract = new ethers.Contract(ROX_ADDRESS, TOKEN_ABI, provider);

  loadAirdropData();
}

async function loadAirdropData() {
  if (!airdropContract || !userAddress) return;

  try {
    // Pool balance - clean number
    const poolBal = await tokenContract.balanceOf(airdropContract.address);
    const poolClean = parseFloat(ethers.utils.formatEther(poolBal)).toLocaleString();
    document.getElementById('airdropPoolBalance').innerText = poolClean;

    // XP - clean integer (no 18 zeros)
    const xp = await airdropContract.xpOf(userAddress);
    document.getElementById('userAirdropXP').innerText = xp.toString();

    const eligible = await airdropContract.isEligible(userAddress);
    const participants = await airdropContract.totalParticipants();

    document.getElementById('airdropEligible').innerText = eligible ? 'Yes ‚úÖ' : 'No ‚ùå';
    document.getElementById('airdropParticipants').innerText = participants.toString();

  } catch (err) {
    console.error(err);
    alert('Error loading data: ' + err.message);
  }
}

async function executeTask(methodName) {
  if (!airdropContract) return alert('Connect wallet first!');
  try {
    const tx = await airdropContract[methodName]();
    await tx.wait();
    alert('Success! Transaction: ' + tx.hash);
    loadAirdropData();
  } catch (err) {
    alert('Failed: ' + (err.reason || err.message || err));
  }
}

// Navigation
document.querySelectorAll('nav button').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
    const section = document.getElementById(btn.dataset.section);
    if (section) section.classList.add('active');
    btn.classList.add('active');
  });
});

window.addEventListener('load', () => {
  document.querySelector('nav button[data-section="presale"]')?.click();
});

// Event listeners
document.getElementById('connectBtn').addEventListener('click', connectWallet);
document.getElementById('disconnectBtn').addEventListener('click', disconnectWallet);
document.getElementById('dailyCheckinBtn').addEventListener('click', () => executeTask('dailyCheckin'));
document.getElementById('weeklyBonusBtn').addEventListener('click', () => executeTask('claimWeeklyBonus'));
document.getElementById('monthlyBonusBtn').addEventListener('click', () => executeTask('claimMonthlyBonus'));
document.getElementById('holderBonusBtn').addEventListener('click', () => executeTask('claimHolderBonus'));
document.getElementById('nftBonusBtn').addEventListener('click', () => executeTask('claimNFTBonus'));
document.getElementById('campaignBonusBtn').addEventListener('click', () => executeTask('claimCampaignBonus'));
document.getElementById('refreshLeaderboardBtn').addEventListener('click', loadAirdropData);
</script>
</body>
</html>